//Data Sharingの機能の活用
SnowflakeのData Sharingは、ストレージを複製せずに、
  他のSnowflakeアカウント（または外部ユーザー）と
  リアルタイムでテーブル・ビュー・スキーマなどを共有できる仕組みです。

種類	概要
✅ アカウント間共有（Direct Sharing）	他のSnowflakeアカウントとデータを共有
🌐 プロバイダーシェアリング（Data Exchange / Marketplace）	複数の消費者とマーケット経由で共有（有料/無料あり）
🔐 外部共有（Reader Accounts）	Snowflakeアカウントを持たない相手と共有（読み取り専用）

用語	説明
Provider	データを共有する側（共有元）
Consumer	データを受け取る側（共有先）
Share	共有単位。1つのShareに複数のテーブルやビューを含めることができる
Reader Account	プロバイダーが作成した限定的な読み取り専用アカウント


---実践---
-- プロバイダー側の操作
-- ① Shareオブジェクトを作成
CREATE SHARE my_share;

-- ② テーブルを共有に追加
GRANT USAGE ON DATABASE shared_db TO SHARE my_share;
GRANT SELECT ON TABLE shared_db.public.products TO SHARE my_share;

-- ③ コンシューマーアカウントを指定
ALTER SHARE my_share ADD ACCOUNTS = ('consumer_account_locator');


---実践---
-- コンシューマー側の操作(※アカウントを「実際に切り替えて以下操作)

-- 実際にシェアされたかの確認
SHOW SHARES;

-- プロデューサー側のアカウント識別子確認
DESC SHARE <producder_account>.ORDERS_SHARE;
--(SHOW SHARESでみたowner_accountが上記アカウント)

-- ① 共有を使うためのデータベースを作成
CREATE DATABASE consumer_view FROM SHARE <provider_account_locator>.my_share;

-- ② テーブルにアクセス
SELECT * FROM consumer_view.public.products;

-- WAREHOUSEの設定
CREATE WAREHOUSE READ_WH WITH
WAREHOUSE_SIZE = 'X-SMALL'
AUTO_SUSPEND = 180
AUTO_RESUME = TRUE
INITIALLY_SUSPEND = TRUE;

// WAREHOUSEへ権限付与
GRANT USAGE ON WAREHOUSE READ_WH TO ROLE PUBLIC;

---実践---
-- Reader Accountを作成しSnowflakeアカウントを持ってないユーザにも使用可能にする
CREATE MANAGED ACCOUNT tech_joy_account
ADMIN_NAME = tech_joy_admin,
ADMIN_PASSWORD = '5463FgfdGr',
TYPE = READER;

-- 実際に提供するURLを確認する
SHOW MANAGED ACCOUNTS;

-- 実際にデータ共有をする
ALTER SHARE my_share
ADD ACCOUNT = <reader-account-id>;

-- reader側での操作
show shares;

DESC SHARE <producer-account>.my_share;

CREATE DATABASE DATA_SHARE_DB FROM SHARE <producer-account>.my_share;

CREATE WAREHOUSE READ_WH WITH
WAREHOUSE_SIZE = 'X-SMALL'
AUTO_SUSPEND = 180
AUTO_RESUME = TRUE
INITALLY_SUSPENDED = TRUE;

SELECT * FROM DATA_SHARE_DB.PUBLIC.ORDERS;
