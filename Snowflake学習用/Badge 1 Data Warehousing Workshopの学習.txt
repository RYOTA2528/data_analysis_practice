/*
【Badge 1 Data Warehousing Workshop取得に向けたメモ】
*/


/*
【データベースの所有権】
・初期状態のロールは「ACCOUNTADMIN」
・上記の状態で作成したデータベース(DEMO_DB)はロールを切り替えで例えば「SYSADMIN」に変更
　すると閲覧・操作が不可能になる
*/
　
/*
【データベースの所有権を SYSADMIN ロールに譲渡する方法を学ぶ】
・データベース→対象のDB→右上3点リーダー→所有権を移動→移譲
*/

/*
【RBAC（ロールベースアクセス制御）】
・RBACは、ユーザーがアクセスできる範囲を決定するための仕組みです。ユーザーは特定の「役割」を持ち、その役割に基づいて許可される操作が決まります。
・役割に基づいて、承認者が特定のタスクを許可または拒否します。

＜役割と権限の見方＞
役割と権限に関する説明:

役割の変更:

役割は簡単に変更できます。メニューから選択して、ホーム画面の下隅やワークシートの上隅で変更できます。

役割の割り当て:

PUBLIC役割はすべてのユーザーに最初から割り当てられます。この役割には最も少ない特権が与えられています。

ACCOUNTADMINロールはトライアルアカウントユーザーに自動的に割り当てられ、このロールにはほとんどのデータベース権限が含まれます。

役割の継承:

ACCOUNTADMINロールには、RBAC（ロールベースアクセス制御）を通じて3つの追加の役割が自動的に割り当てられます。

役割の使用例:

ACCOUNTADMINロールは非常に強力で、VIPアクセスのような役割です。この役割を持つユーザーはほとんど何でも見たり、操作したりできます。

SYSADMINロールは、データベースやウェアハウス、テーブル、ビューなどの管理に使われます。SYSADMINロールを使いこなすことで、より細かな管理が可能になります。

組織的な役割（ORGADMIN）:

ORGADMINロールは、Snowflakeアカウントの新規作成や高度な構成を管理するために非常に強力な権限を持っています。ORGADMINは主にアカウント管理を行う役割です。


<ACCOUNTADMINと同じツリーにあるもの>
ACCOUNTADMIN と同じツリーまたはチャートにある役割は以下の通りです：

SYSADMIN
→ 同じツリーにあります。SYSADMINはACCOUNTADMINと同じレベルであり、重要な管理ロールです。

SECURITYADMIN
→ 同じツリーにあります。SECURITYADMINもACCOUNTADMINの上位に位置する役割です。

USERADMIN
→ 同じツリーにあります。USERADMINはACCOUNTADMINと同じレベルであり、ユーザーの管理に関わります。
*/


/*
【DACについて】
**DAC（裁量アクセス制御）**とは、リソースの所有者が誰にアクセスを許可するかを決定するアクセス制御の方式です。具体的には、所有者が自分のリソース（例えばGoogleドキュメント）を他のユーザーと共有する際に、誰にアクセスを許可するかを選ぶことができます。これにより、リソースの所有者が裁量的にアクセス権を管理します。

例えば、Googleドキュメントの所有者は、そのドキュメントを誰と共有するかを自由に選ぶことができ、そのアクセス権限を管理することができます。これは典型的なDACの例です。

役割とアクセス制御についても触れています。例えば、SYSADMINロールは、特定のテーブルにアクセスできるかどうかを制御する役割であり、アクセスを管理する重要な役割となります。

要するに、DACは「リソース所有者がアクセスを決定する」仕組みであり、特定のロール（例えばSYSADMIN）がアクセスできるかどうかを制御することになります。
*/


/*
【デフォルトロールについて】
トライアル アカウント ユーザーとして割り当てられているデフォルトのロールは、ACCOUNTADMIN ロールです。
システム ロール (ワークシートではなく上隅) を別のロールに変更した場合、ログアウトして再度ログインすると、ロールはデフォルトに戻ります。
*/




【ロールの所有権を変更する】
ACCOUNTADMINロールに切り替える
スキーマの所有権を変更するためには、ACCOUNTADMINロールに切り替える必要があります。SYSADMINロールでは所有権の変更ができないためです。


USE ROLE ACCOUNTADMIN;
所有権の変更
PUBLICスキーマの所有権をSYSADMINロールに変更します。これにより、SYSADMINロールがそのスキーマに対して完全なアクセス権を持つことができます。


ALTER SCHEMA PUBLIC SET OWNER = ROLE SYSADMIN;
変更を確認する
所有権が変更された後、SYSADMINロールでスキーマが確認できることを確認してください。これには、ブラウザを更新して、新しいアクセス権が反映されていることを確認します。

完了としてマーク
すべてが設定されたら、手順を完了としてマークできます。

この手順で、SYSADMINロールがPUBLICスキーマを表示および使用できるようになります。