# install Nginx using Ansible
# Start and Enable Nginx
# Check the status of Nginx
# Collect host information
- name: Setup nginx server on myserver list (host group)
  hosts:
    - devservers
    - testservers
  become: True #plyabook実行時に権限エラーを防ぐため
  tasks:
    - name: Install the latest version of nginx
      command: amazon-linux-extras install nginx -y
      

    - name: Start nginx service
      service:
        name: nginx
        state: started
        
        

    - name: Enable nginx service #自動起動の有効化
      service:
        name: nginx
        enabled: yes
        
        

    - name: Get nginx Installed version #インストールしたNginxのversion取得
      command: nginx -v
      

    - name: Get status of nginx service #Nginxの状態取得取得
      command: systemctl status nginx


### 上記設定が終わり次第まずはhostファイルの修正を実施
#TeraTermでマスターノードへssh接続
↓
①sudo vim /etc/ansible/hosts
・・・
#Ex 1:・・・
[devservers]
18.181.250.245
3.112.21.90

[testservers]
18.183.250.63
35.78.92.193
・・・
      
↓
②playbookをマスターノードに作成(※上記までで作成した内容をそのまま転記)
vim install_nginx.yaml
↓
③ansible-playbook install_nginx.yaml -v (ansibleを実行する)→エラーになる
↓
④sshエージェントの起動が終了してしなってるため再起動
ssh-agent bash
↓
⑤sudo cp ec2-key.pem ~/.ssh/
↓
⑥ssh-add ~/.ssh/ec2-key.pem
↓
⑦再実行 ansible-playbook install_nginx.yaml -v
